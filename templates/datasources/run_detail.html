{% extends "layout.html" %}
{% block title %}Run SQL Detail · {{ checkpoint.name }} · DB Vulnerability Scan{% endblock %}

{% block content %}
<style>
.rt-wrap{background:#fff;border:1px solid #e5e9f2;border-radius:12px;padding:16px;max-width:1100px;margin:auto;}
.rt-row{display:flex;gap:20px;flex-wrap:wrap;margin-bottom:16px;}
.rt-col{flex:1 1 260px;}
.rt-label{font-size:13px;font-weight:600;margin-bottom:4px;display:block;}
.rt-textarea{width:100%;min-height:120px;border-radius:8px;border:1px solid #d9d9d9;padding:8px 10px;font-family:monospace;font-size:13px;}
.rt-select{width:100%;border-radius:8px;border:1px solid #d9d9d9;padding:6px 10px;}
.rt-actions{margin-top:16px;display:flex;gap:10px;}
.btn{padding:8px 16px;border-radius:8px;border:1px solid #dcdcdc;background:#fff;cursor:pointer;font-size:14px;text-decoration:none;}
.btn-primary{background:#2563eb;border-color:#1d4ed8;color:#fff;}
.btn-primary:hover{background:#1d4ed8;}
.rt-result{margin-top:20px;padding:12px;border-radius:8px;background:#0f172a;color:#e5e7eb;font-family:monospace;font-size:13px;white-space:pre-wrap;}
.rt-error{margin-top:12px;color:#b91c1c;font-size:13px;}
</style>

<div class="rt-wrap">
  <h3 style="font-weight:800;margin-bottom:12px;">Run SQL Detail – {{ checkpoint.name }}</h3>
  <p style="font-size:13px;margin-bottom:12px;">
    DB Type: <strong>{{ checkpoint.db_type }}</strong> · Severity: <strong>{{ checkpoint.severity }}</strong>
  </p>

  <form method="post">
    <div class="rt-row">
      <div class="rt-col">
        <label class="rt-label">Datasource</label>
        <select name="datasource_id" class="rt-select">
          <option value="">-- Select datasource --</option>
          {% for ds in datasources %}
            <option value="{{ ds.id }}"
              {% if selected_ds_id and selected_ds_id|string == ds.id|string %}selected{% endif %}>
              {{ ds.name }}
            </option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="rt-row">
      <div class="rt-col">
        <label class="rt-label">Pre SQL Detail</label>
        <textarea class="rt-textarea" readonly>{{ checkpoint.pre_sql_detail }}</textarea>
      </div>
      <div class="rt-col">
        <label class="rt-label">SQL Detail</label>
        <textarea class="rt-textarea" readonly>{{ checkpoint.sql_detail }}</textarea>
      </div>
    </div>

    <div class="rt-actions">
      <button type="submit" class="btn btn-primary">Run</button>
      <a href="{{ url_for('checkpoints.edit_checkpoint', checkpoint_id=checkpoint.id) }}" class="btn">
        Back to Checkpoint
      </a>
    </div>
  </form>

  {% if error_text %}
    <div class="rt-error">{{ error_text }}</div>
  {% endif %}

  {% if result_text %}
    <div class="rt-result">{{ result_text }}</div>
  {% endif %}
</div>
{% endblock %}
