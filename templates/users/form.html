{% extends "layout.html" %}
{% block title %}{{ 'Edit' if row else 'New' }} User · DB Vulnerability Scan{% endblock %}

{% block content %}
<style>
.form-card{background:#fff;border:1px solid #e5e9f2;border-radius:12px;max-width:760px}
.form-head{padding:12px 14px;border-bottom:1px solid #e5e9f2;font-weight:800}
.form-body{padding:14px}
.form-row{display:flex;flex-direction:column;margin-bottom:12px}
.form-row label{font-weight:600;margin-bottom:6px}
.form-row input,.form-row select{border:1px solid #e5e9f2;border-radius:8px;padding:10px}
.form-actions{display:flex;gap:10px;margin-top:10px}
.btn{padding:10px 14px;border-radius:10px;text-decoration:none;display:inline-block}
.btn-primary{background:#2563eb;color:#fff;border:1px solid #1d4ed8}
.btn-primary:hover{background:#1d4ed8}
.btn-muted{background:#fff;border:1px solid #e5e9f2;color:#0f172a}
.help{color:#64748b;font-size:13px;margin-top:8px}
</style>

<div class="form-card">
  <div class="form-head">{{ 'Edit' if row else 'New' }} User</div>

  <form method="post" class="form-body">

    {% if row %}
      <input type="hidden" name="user_id" value="{{ row.user_id }}">
    {% endif %}

    <!-- Alanlar alt alta, datasources formatında -->
    <div class="form-row">
      <label>Username *</label>
      <input name="username" required value="{{ row.username if row }}" {{ 'readonly' if row }}>
    </div>

    <div class="form-row">
      <label>Password {{ '(leave blank to keep)' if row else '*' }}</label>
      <input name="password" type="password" {{ 'required' if not row }}>
      {% if row %}
        <div class="help">Şifreyi değiştirmek istemiyorsan boş bırak.</div>
      {% endif %}
    </div>

    <div class="form-row">
      <label>Full Name</label>
      <input name="full_name" value="{{ row.full_name if row }}">
    </div>

    <div class="form-row">
      <label>Email</label>
      <input name="email" type="email" value="{{ row.email if row }}">
    </div>

    <div class="form-row">
      <label>Role</label>
      {% set val_role = row.role if row else 'viewer' %}
      <select name="role" required>
        <option value="admin"   {{ 'selected' if val_role=='admin' }}>Admin</option>
        <option value="analyst" {{ 'selected' if val_role=='analyst' }}>Analyst</option>
        <option value="viewer"  {{ 'selected' if val_role=='viewer' }}>Viewer</option>
      </select>
    </div>

    <div class="form-row">
      <label>Status</label>
      {% set val_status = row.status if row else 'active' %}
      <select name="status">
        <option value="active"   {{ 'selected' if val_status=='active' }}>Active</option>
        <option value="inactive" {{ 'selected' if val_status=='inactive' }}>Inactive</option>
        <option value="locked"   {{ 'selected' if val_status=='locked' }}>Locked</option>
      </select>
    </div>

    <div class="form-actions">
      <button class="btn btn-primary" type="submit">Save</button>
      <a class="btn btn-muted" href="{{ url_for('users.list_users') }}">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}
