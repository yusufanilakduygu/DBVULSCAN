<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}DB Vulnerability Scan{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f3f6fb;        /* çok açık gri-mavi arka plan */
      --panel:#ffffff;     /* kart/menü arkaplanı */
      --line:#e5e9f2;      /* panel sınırı */
      --text:#0f172a;      /* koyu metin */
      --muted:#64748b;     /* ikincil metin */
      --hover:#f8fbff;     /* menü hover */
      --brand:#0f172a;     /* marka yazısı */
      --chip:#eef2ff;      /* aktif menü çipi */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{display:grid; grid-template-columns: 270px 1fr; min-height:100vh;}

    /* SIDEBAR */
    .sidebar{
      padding:14px 14px 20px;
      border-right:1px solid var(--line);
      background:var(--panel);
    }
    .card{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
    }
    .brand{
      font-weight:800; font-size:18px; text-decoration:none; color:var(--brand);
      display:block; text-align:left;
    }
    .userbox{margin-top:10px; line-height:1.35; font-size:13px; color:var(--muted)}
    .section{margin-top:12px}
    .section h4{
      margin:10px 8px 6px; font-size:12px; color:var(--muted); font-weight:700;
    }
    .menu{display:flex; flex-direction:column; gap:8px; padding:8px}
    .menu a{
      display:block; padding:10px 12px; border:1px solid var(--line); border-radius:12px;
      color:var(--text); text-decoration:none; background:#fff; text-align:left; font-weight:600;
      transition:.15s ease; box-shadow:0 0 0 rgba(0,0,0,0);
    }
    .menu a:hover{ background:var(--hover) }
    .menu a.active{ background:var(--chip); border-color:#c7d2fe }

    /* TOP BAR */
    .top{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 18px; border-bottom:1px solid var(--line); background:#fff;
      position:sticky; top:0; z-index:5;
    }
    .top a.title{
      color:var(--brand); text-decoration:none; font-weight:800; font-size:18px;
    }
    .logout a{
      display:inline-block; padding:8px 12px; border:1px solid var(--line);
      border-radius:10px; text-decoration:none; color:#0f172a; background:#fff;
    }

    /* MAIN */
    .main{ padding:20px 24px 28px; }
    .flashwrap{margin:0 0 12px; display:grid; gap:8px}
    .flash{padding:10px 12px; border:1px solid var(--line); border-radius:10px; background:#fff}
    .flash.success{ background:#ecfdf5; border-color:#a7f3d0; color:#065f46 }
    .flash.error{ background:#fef2f2; border-color:#fecaca; color:#7f1d1d }

    /* responsive */
    @media (max-width: 980px){
      .wrap{grid-template-columns:1fr}
      .sidebar{display:none}
      .main{padding:16px}
    }
  </style>
  {% block head %}{% endblock %}
</head>
<body>
  <div class="wrap">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="card">
        <a class="brand" href="{{ url_for('home') }}">DB Vulnerability Scan</a>
        <div class="userbox">
          User: {{ current_user }}<br/>
          Role: {{ current_role }}
        </div>
      </div>

      <!-- Kısa hızlı menü -->
      <div class="section">
        <div class="menu">
          <a href="{{ url_for('datasources.list_datasources') }}"
             class="{% if request.path.startswith('/datasources') %}active{% endif %}">DataSources</a>
          {% if current_role in ['admin','editor'] %}
          <a href="{{ url_for('users.list_users') }}"
             class="{% if request.path.startswith('/users') %}active{% endif %}">Users</a>
          {% endif %}
        </div>
      </div>

      <!-- Vulnerability Assessments -->
      <div class="section">
        <h4>Vulnerability Assessments</h4>
        <div class="menu">
          <a href="/checkpoints" class="{% if request.path.startswith('/checkpoints') %}active{% endif %}">CheckPoints</a>
          <a href="/benchmarks" class="{% if request.path.startswith('/benchmarks') %}active{% endif %}">Benchmarks</a>
          <a href="/assessments" class="{% if request.path.startswith('/assessments') %}active{% endif %}">Assessments</a>
          <a href="/assessment-analysis" class="{% if request.path.startswith('/assessment-analysis') %}active{% endif %}">Assessment Analysis</a>
        </div>
      </div>

      <!-- Security Reports -->
      <div class="section">
        <h4>Security Reports</h4>
        <div class="menu">
          <a href="/queries" class="{% if request.path.startswith('/queries') %}active{% endif %}">Queries</a>
          <a href="/querysets" class="{% if request.path.startswith('/querysets') %}active{% endif %}">QuerySets</a>
          <a href="/reports" class="{% if request.path.startswith('/reports') %}active{% endif %}">Reports</a>
        </div>
      </div>

      <!-- Help -->
      <div class="section">
        <div class="menu">
          <a href="/help" class="{% if request.path.startswith('/help') %}active{% endif %}">Help</a>
        </div>
      </div>
    </aside>

    <!-- CONTENT -->
    <div>
      <div class="top">
        <a class="title" href="{{ url_for('home') }}">DB Vulnerability Scan</a>
        <div class="logout">
          <a href="{{ url_for('auth.logout') }}">Logout</a>
        </div>
      </div>

      <main class="main">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flashwrap">
              {% for cat, msg in messages %}
                <div class="flash {{ cat }}">{{ msg }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
      </main>
    </div>
  </div>
</body>
</html>
